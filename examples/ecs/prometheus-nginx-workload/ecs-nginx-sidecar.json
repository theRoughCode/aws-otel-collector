{
    "family": "aoc-ec2-nginx",
    "taskRoleArn": "ecs-aoc",
    "executionRoleArn": "ecs-aoc",
    "networkMode": "bridge",
    "containerDefinitions": [
      {
        "name": "apple",
        "image": "hashicorp/http-echo",
        "cpu": "100",
        "memory": "100",
        "essential": true,
        "command": ["-text=apple"],
        "portMappings": [
          {
            "containerPort": 5678
          }
        ],
        "dependsOn": [],
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "/ecs/aoc-ec2-nginx-apple",
            "awslogs-region": "us-west-2",
            "awslogs-stream-prefix": "ecs",
            "awslogs-create-group": "True"
          }
        }
      },
      {
        "name": "banana",
        "image": "hashicorp/http-echo",
        "cpu": "100",
        "memory": "100",
        "essential": true,
        "command": ["-text=banana"],
        "dependsOn": [],
        "portMappings": [
          {
            "containerPort": 5678
          }
        ],
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "/ecs/aoc-ec2-nginx-banana",
            "awslogs-region": "us-west-2",
            "awslogs-stream-prefix": "ecs",
            "awslogs-create-group": "True"
          }
        }
      },
      {
        "name": "traffic-generator",
        "image": "ellerbrock/alpine-bash-curl-ssl",
        "cpu": "100",
        "memory": "100",
        "essential": true,
        "command": ["/bin/bash", "-c", "while :; do curl http://nginx-reverse-proxy/apple > /dev/null 2>&1; curl http://nginx-reverse-proxy/banana > /dev/null 2>&1; sleep 1; done"],
        "dependsOn": [
          {
            "containerName": "nginx-reverse-proxy",
            "condition": "START"
          }
        ],
        "links": [
          "nginx-reverse-proxy"
        ],
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "/ecs/aoc-ec2-nginx-traffic-generator",
            "awslogs-region": "us-west-2",
            "awslogs-stream-prefix": "ecs",
            "awslogs-create-group": "True"
          }
        }
      },
      {
        "name": "nginx-reverse-proxy",
        "image": "kohrapha/reverse-proxy",
        "cpu": "256",
        "memory": "256",
        "essential": true,
        "portMappings": [
          {
            "containerPort": 80
          }
        ],
        "links": [
          "apple",
          "banana"
        ],
        "dependsOn": [],
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "/ecs/aoc-ecs-nginx-reverse-proxy",
            "awslogs-region": "us-west-2",
            "awslogs-stream-prefix": "ecs",
            "awslogs-create-group": "True"
          }
        }
      },
      {
        "name": "nginx-prometheus-exporter",
        "image": "nginx/nginx-prometheus-exporter:0.8.0",
        "cpu": "256",
        "memory": "256",
        "essential": true,
        "command": ["-nginx.scrape-uri", "http://nginx-reverse-proxy:80/metrics"],
        "portMappings": [
          {
            "containerPort": 9113
          }
        ],
        "links": [
          "nginx-reverse-proxy"
        ],
        "dependsOn": [],
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "/ecs/aoc-ecs-nginx-prometheus-exporter",
            "awslogs-region": "us-west-2",
            "awslogs-stream-prefix": "ecs",
            "awslogs-create-group": "True"
          }
        }
      },
      {
        "name": "aws-otel-collector",
        "image": "kohrapha/awscollector:v0.4.0",
        "cpu": "1000",
        "memory": "1000",
        "portMappings": [
          {
            "containerPort": 55680,
            "hostPort": 55680,
            "protocol": "tcp"
          }
        ],
        "essential": true,
        "command": ["--config=/etc/otel-config.yaml", "--log-level=DEBUG"],
        "links": [
          "nginx-prometheus-exporter"
        ],
        "dependsOn": [],
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "/ecs/aoc-ecs-collector",
            "awslogs-region": "us-west-2",
            "awslogs-stream-prefix": "ecs",
            "awslogs-create-group": "True"
          }
        }
      }
    ],
    "requiresCompatibilities": [
      "EC2"
    ]
  }
  